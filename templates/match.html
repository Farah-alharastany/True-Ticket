<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุชูุงุตูู ุงููุจุงุฑุงุฉ</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
    <style>
      body {
        font-family: "Tajawal", sans-serif;
      }
      .btn {
        transition: background-color 0.3s, transform 0.3s;
      }
      .btn:hover {
        background-color: #16a34a;
        transform: scale(1.05);
      }
      .dark .bg-gray-800 {
        background-color: #2c2c2c;
      }
      .dark .text-gray-300 {
        color: #e0e0e0;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 text-black dark:text-white transition duration-300"
  >
    <!-- Header -->
    <header
      class="bg-white dark:bg-gray-800 shadow-md py-4 px-6 flex items-center justify-between rounded-b-xl"
    >
      <img
        class="w-20"
        src="{{url_for('static', filename='logo.png')}}"
        alt="ุงูุดุนุงุฑ"
      />
      <nav class="flex gap-6 text-lg font-medium">
        <a href="#" class="hover:text-green-600">ุงูุฑุฆูุณูุฉ</a>
        <a href="#" class="hover:text-green-600">ุงูุชุฐุงูุฑ</a>
        <a href="#" class="hover:text-green-600">ุงุชุตู ุจูุง</a>
        <a href="#" class="hover:text-green-600">ุงูุฃุฎุจุงุฑ</a>
      </nav>
      <div onclick="toggleDarkMode()" class="cursor-pointer">
        <iconify-icon
          id="theme-icon"
          icon="mdi:weather-sunny"
          class="text-3xl"
        ></iconify-icon>
      </div>
    </header>

    <!-- Match Details -->
    <main class="max-w-6xl mx-auto py-12 px-6">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
        <!-- Match Info -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-4">
            <!-- Flag and Team 1 Image -->
            <img
              id="team1-flag"
              src="https://flagcdn.com/w320/{{ team1Flag }}.png"
              alt=""
              class="w-16 h-16 object-cover rounded-full"
            />
            <h2 class="text-3xl font-bold" id="match-title">
              {{ team1 }} ๐ช๐ธ vs {{ team2 }} ๐ฉ๐ช
            </h2>
            <!-- Flag and Team 2 Image -->
            <img
              id="team2-flag"
              src="https://flagcdn.com/w320/{{ team2Flag }}.png"
              alt=""
              class="w-16 h-16 object-cover rounded-full"
            />
          </div>
          <!-- Match Stage -->
          <span
            class="text-xl font-semibold text-gray-600 dark:text-gray-300"
            id="stage"
            >{{ stage }}</span
          >
        </div>

        <!-- Match Pricing -->
        <div class="mb-6">
          <h3 class="text-2xl font-bold mb-4">ุชูุงุตูู ุงูุชุฐูุฑุฉ</h3>
          <p class="text-lg text-gray-600 dark:text-gray-300 mb-2">
            ุงููุฑุญูุฉ: <span id="stage">{{ stage }}</span>
          </p>
          <p class="text-lg text-gray-600 dark:text-gray-300 mb-2">
            ุงููุฆุฉ: <span id="seat"></span>
          </p>
          <p class="text-lg text-gray-600 dark:text-gray-300 mb-4">
            ุงูุณุนุฑ ุงููุชููุน:
            <span id="price"
              >{{ price if price else "ูู ูุชู ุงูุชูุจุค ุจุงูุณุนุฑ ุจุนุฏ" }}</span
            >
            ุฑูุงู ุณุนูุฏู
          </p>
        </div>

        <!-- Purchase Button Form -->
        <form id="predictForm" class="space-y-4">
          <!-- Hidden Inputs with Data for Prediction -->
          <input type="hidden" name="base_price" id="base_price" />
          <input type="hidden" name="seat_multiplier" id="seat_multiplier" />
          <input type="hidden" name="tickets_sold" id="tickets_sold" />
          <input type="hidden" name="days_until" id="days_until" />
          <input type="hidden" name="importance" id="importance" />
          <input type="hidden" name="stage" id="hidden-stage" />
          <input type="hidden" name="venue" id="venue" />
          <input type="hidden" name="team1" id="team1" />
          <input type="hidden" name="team2" id="team2" />
          <input type="hidden" name="year" id="year" />
        
          <!-- Dynamic Inputs -->
          <input type="hidden" name="stage" id="input-stage" value="{{ stage }}" />
        
          <!-- Seat Type Selection -->
          <label for="seat-select" class="block text-lg font-medium">ุงุฎุชุฑ ููุน ุงูุชุฐูุฑุฉ:</label>
          <select
            name="seat"
            id="seat-select"
            class="w-full p-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-black dark:text-white"
          >
            <option value="Silver">ูุถูุฉ</option>
            <option value="Gold">ุฐูุจูุฉ</option>
            <option value="VIP">ูุจุงุฑ ุงูุดุฎุตูุงุช</option>
          </select>
        
          <!-- Display Error Message if exists -->
          {% if error_message %}
          <div class="text-red-600 font-semibold py-4 bg-red-100 rounded-xl mb-6">
            {{ error_message }}
          </div>
          {% endif %}
        
          <!-- Submit Button -->
          <button
            type="button"
            id="buyBtn"
            class="btn block w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl text-center font-semibold"
          >
            ุดุฑุงุก ุงูุชุฐูุฑุฉ ุงูุขู
          </button>
        </form>
        
      </div>
    </main>

    <script>
      document.getElementById("buyBtn").addEventListener("click", function () {
        // ุฌูุน ุงูุจูุงูุงุช ูู URL ูุชูุฑูุฑูุง
        const urlParams = new URLSearchParams(window.location.search);
        const basePrice = urlParams.get("base_price");
        const seatMultiplier = urlParams.get("seat_multiplier");
        const ticketsSold = urlParams.get("tickets_sold");
        const daysUntil = urlParams.get("days_until");
        const importance = urlParams.get("importance");
        const stage = urlParams.get("stage");
        const venue = urlParams.get("venue");
        const team1 = urlParams.get("team1");
        const team2 = urlParams.get("team2");
        const year = urlParams.get("year");
    
        // ุชุนุจุฆุฉ ุงูุญููู ุงููุฎููุฉ ุจุงูููู
        document.getElementById("base_price").value = basePrice;
        document.getElementById("seat_multiplier").value = seatMultiplier;
        document.getElementById("tickets_sold").value = ticketsSold;
        document.getElementById("days_until").value = daysUntil;
        document.getElementById("importance").value = importance;
        document.getElementById("hidden-stage").value = stage;
        document.getElementById("venue").value = venue;
        document.getElementById("team1").value = team1;
        document.getElementById("team2").value = team2;
        document.getElementById("year").value = year;
    
        // ุฅุฑุณุงู ุงูุทูุจ ุฅูู ุงูุณูุฑูุฑ ุนุจุฑ AJAX
        fetch('/predict', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            base_price: basePrice,
            seat_multiplier: seatMultiplier,
            tickets_sold: ticketsSold,
            days_until: daysUntil,
            importance: importance,
            stage: stage,
            venue: venue,
            team1: team1,
            team2: team2,
            year: year,
          }),
        })
        .then(response => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then(data => {
          if (data.predicted_price) {
            // ุนุฑุถ ุงูุณุนุฑ ุงููุชูุจุฃ ุจู ูู ุงูุตูุญุฉ
            document.getElementById("price").textContent = data.predicted_price + " ุฑูุงู ุณุนูุฏู";
          } else {
            alert("ุญุฏุซ ุฎุทุฃ ูู ุงูุญุณุงุจ. ุญุงูู ูุฌุฏุฏูุง.");
          }
        })
        .catch(error => {
          console.error("Error:", error);
          alert("ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ.");
        });
      });
    </script>
  </body>
</html>
