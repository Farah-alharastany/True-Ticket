# -*- coding: utf-8 -*-
"""Untitled14.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FsfPoyktC2g1MvE1HKVi2KkVliokCq46
"""

# ----------------------------
# 1. Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
# ----------------------------
import pandas as pd
import numpy as np
from sklearn.preprocessing import LabelEncoder
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split
from sklearn.metrics import r2_score, mean_squared_error
import joblib

# ----------------------------
# 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„Ø©
# ----------------------------
df = pd.read_csv("/content/Modified_Ticket_Pricing.csv")
df.columns = df.columns.str.strip()

# ----------------------------
# 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù†Ø§Ù‚ØµØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙØ©
# ----------------------------
df['Seat_Multiplier'] = df['Seat_Multiplier'].fillna(3.0)  # Ù†Ø¶ÙŠÙ Ù…Ø¶Ø§Ø¹Ù Ù„Ù„Ù…Ù‚Ø¹Ø¯ Diamond
mask = df['Base_Price_Base'].isna()
df.loc[mask, 'Base_Price_Base'] = df.loc[mask, 'Base_Price'] / df.loc[mask, 'Seat_Multiplier']

# ----------------------------
# 4. ØªØ±Ù…ÙŠØ² Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
# ----------------------------
df['Importance_Num'] = LabelEncoder().fit_transform(df['Importance'])

# ----------------------------
# 5. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø±Ø¬Ø§Øª
# ----------------------------
X = df[['Importance_Num', 'Days_until_match', 'Tickets_Sold']]
y = df['Base_Price_Base']

# ----------------------------
# 6. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
# ----------------------------
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ----------------------------
# 7. ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ÙˆØ¯Ù„
# ----------------------------
model = RandomForestRegressor(random_state=42)
model.fit(X_train, y_train)

# ----------------------------
# 8. Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯Ù„
# ----------------------------
joblib.dump(model, "ticket_price_predictor.pkl")

# ----------------------------
# 9. ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
# ----------------------------
y_train_pred = model.predict(X_train)
y_test_pred = model.predict(X_test)

train_r2 = r2_score(y_train, y_train_pred)
test_r2 = r2_score(y_test, y_test_pred)
train_rmse = np.sqrt(mean_squared_error(y_train, y_train_pred))
test_rmse = np.sqrt(mean_squared_error(y_test, y_test_pred))

print(f"ğŸ¯ RÂ² Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨: {train_r2:.2f}")
print(f"ğŸ¯ RÂ² Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {test_r2:.2f}")
print(f"ğŸ“‰ RMSE Ø¹Ù„Ù‰ Ø§Ù„ØªØ¯Ø±ÙŠØ¨: {train_rmse:.2f}")
print(f"ğŸ“‰ RMSE Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {test_rmse:.2f}")

# ----------------------------
# 10. ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…ÙˆØ¯Ù„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
# ----------------------------
new_data = pd.DataFrame([
    [2, 3, 0.95],  # high importance, 3 days left, 95% sold
    [0, 10, 0.1]   # low importance, 10 days left, 10% sold
], columns=['Importance_Num', 'Days_until_match', 'Tickets_Sold'])

predictions = model.predict(new_data)
print("\nğŸ“Œ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:")
for i, pred in enumerate(predictions):
    print(f"Ø¹ÙŠÙ†Ø© {i+1}: Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ = {pred:.2f}")

